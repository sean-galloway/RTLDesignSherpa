# Testplan for bridge_1x4 (rd/wr variants with APB)
# Maps functional test scenarios to verification coverage

module: bridge_1x4
rtl_file: projects/components/bridge/rtl/generated/bridge_1x4_{rd,wr}/bridge_1x4_{rd,wr}.sv
test_file: projects/components/bridge/dv/tests/test_bridge_1x4_{rd,wr}.py

# Module description:
# Single master to quad slave bridge with read-only (rd) or write-only (wr) variants.
# Includes APB slave (slave 3) requiring protocol conversion from AXI4 to APB.
# Four-way address decode with mixed AXI4/APB protocol support.

parameters:
  - name: NUM_MASTERS
    default: 1
    description: Number of master ports
  - name: NUM_SLAVES
    default: 4
    description: Number of slave ports (3 AXI4 + 1 APB)
  - name: ADDR_WIDTH
    default: 32
    description: Address bus width
  - name: DATA_WIDTH
    default: 32
    description: Data bus width
  - name: ID_WIDTH
    default: 4
    description: Transaction ID width

# Address map
address_map:
  - slave: ddr_rd/ddr_wr (Slave 0 - AXI4)
    base: 0x00000000
    range: 0x40000000
    description: DDR memory region
  - slave: sram_rd/sram_wr (Slave 1 - AXI4)
    base: 0x40000000
    range: 0x40000000
    description: SRAM memory region
  - slave: periph_rd/periph_wr (Slave 2 - AXI4)
    base: 0x80000000
    range: 0x40000000
    description: Peripheral region
  - slave: apb0 (Slave 3 - APB)
    base: 0xC0000000
    range: 0x40000000
    description: APB peripheral region (requires AXI4→APB conversion)

# Functional scenarios
functional_scenarios:
  - id: BRIDGE-1x4-01
    name: "Four-way address routing"
    description: Single master routes to any of four slaves (3 AXI4 + 1 APB)
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - Four-way address decode
      - Master to AXI4 slave 0/1/2 routing
      - Master to APB slave 3 routing
    priority: high
    status: verified

  - id: BRIDGE-1x4-02
    name: "AXI4 slave routing"
    description: Verify AR/R or AW/W/B channels to AXI4 slaves (0, 1, 2)
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4 channel routing to slaves 0/1/2
      - Native AXI4 protocol maintained
    priority: high
    status: verified

  - id: BRIDGE-1x4-03
    name: "APB protocol conversion"
    description: AXI4 to APB conversion for slave 3
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4→APB address conversion
      - AXI4→APB data conversion
      - APB enable/select signaling
      - APB response handling
    priority: high
    status: partial
    notes: APB converter placeholder exists, full implementation pending Phase 3

  - id: BRIDGE-1x4-04
    name: "Mixed protocol transaction sequence"
    description: Alternate between AXI4 and APB slaves
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4 slave → APB slave → AXI4 slave sequence
      - Protocol switching overhead
      - State machine transitions
    priority: medium
    status: partial
    notes: Requires APB converter completion

  - id: BRIDGE-1x4-05
    name: "Transaction ID preservation"
    description: Verify ID signals for AXI4 slaves, ID handling for APB
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - ID forwarding to AXI4 slaves (0/1/2)
      - ID regeneration for APB slave (3)
      - ID matching on responses
    priority: high
    status: verified

  - id: BRIDGE-1x4-06
    name: "Address decode boundaries"
    description: Four slave region boundaries
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - Slave 0/1 boundary (0x3FFFFFFF/0x40000000)
      - Slave 1/2 boundary (0x7FFFFFFF/0x80000000)
      - Slave 2/3 boundary (0xBFFFFFFF/0xC0000000) - AXI4/APB transition
    priority: medium
    status: verified

  - id: BRIDGE-1x4-07
    name: "Backpressure per slave"
    description: Independent backpressure from each slave
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4 slave ready propagation (slaves 0/1/2)
      - APB slave ready propagation (slave 3)
    priority: high
    status: verified

  - id: BRIDGE-1x4-08
    name: "Response codes from all slaves"
    description: OKAY/SLVERR from AXI4 and APB slaves
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4 response codes (RRESP/BRESP)
      - APB response codes (PSLVERR)
      - Response code translation APB→AXI4
    priority: high
    status: partial
    notes: APB response handling pending converter completion

# Parameter combinations tested
parameter_coverage:
  - variant: rd
    ADDR_WIDTH: 32
    DATA_WIDTH: 32
    ID_WIDTH: 4
    test_level: basic
    status: verified
    notes: AXI4 slaves fully tested, APB slave placeholder

  - variant: wr
    ADDR_WIDTH: 32
    DATA_WIDTH: 32
    ID_WIDTH: 4
    test_level: basic
    status: verified
    notes: AXI4 slaves fully tested, APB slave placeholder

# Implied coverage calculation
implied_coverage:
  total_scenarios: 8
  verified_scenarios: 5
  partial_scenarios: 3
  implied_percentage: 62.5
  notes: |
    AXI4 routing scenarios (5/8) fully verified.
    APB-related scenarios (3/8) partially implemented with placeholder converter.
    Full coverage requires Phase 3 APB converter implementation.

notes: |
  Bridge 1x4 introduces mixed protocol support with APB slave.
  Available in two channel variants:
  - bridge_1x4_rd: Read-only channels (AR, R)
  - bridge_1x4_wr: Write-only channels (AW, W, B)

  Key features:
  - Four-way address decode
  - Mixed AXI4/APB protocol support
  - APB converter placeholder (Phase 3 implementation pending)
  - Tests protocol conversion architecture

  Current status:
  - AXI4 slave routing (slaves 0/1/2): FULLY VERIFIED
  - APB slave routing (slave 3): PLACEHOLDER ONLY
  - APB converter: TODO (Phase 3)

  Test coverage:
  - Four-way routing verified for AXI4 slaves
  - APB slave routing structure exists but converter not implemented
  - Transaction ID handling verified for AXI4 paths
  - Address boundaries verified including AXI4/APB transition point
  - Backpressure verified for AXI4 slaves
  - Response codes verified for AXI4 paths

  Gap analysis:
  - APB protocol conversion needs Phase 3 completion
  - Mixed protocol transaction sequences need full APB support
  - APB-specific response handling pending
