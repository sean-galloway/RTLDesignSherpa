# Testplan for bridge_1x5 (rd/wr variants with AXIL)
# Maps functional test scenarios to verification coverage

module: bridge_1x5
rtl_file: projects/components/bridge/rtl/generated/bridge_1x5_{rd,wr}/bridge_1x5_{rd,wr}.sv
test_file: projects/components/bridge/dv/tests/test_bridge_1x5_{rd,wr}.py

# Module description:
# Single master to five slave bridge with read-only (rd) or write-only (wr) variants.
# Includes AXI4-Lite slave (slave 4) requiring protocol conversion from AXI4 to AXIL.
# Five-way address decode with mixed AXI4/AXIL protocol support.

parameters:
  - name: NUM_MASTERS
    default: 1
    description: Number of master ports
  - name: NUM_SLAVES
    default: 5
    description: Number of slave ports (4 AXI4 + 1 AXIL)
  - name: ADDR_WIDTH
    default: 32
    description: Address bus width
  - name: DATA_WIDTH
    default: 32
    description: Data bus width
  - name: ID_WIDTH
    default: 4
    description: Transaction ID width

# Address map
address_map:
  - slave: ddr_rd/ddr_wr (Slave 0 - AXI4)
    base: 0x00000000
    range: 0x20000000
    description: DDR memory region
  - slave: sram_rd/sram_wr (Slave 1 - AXI4)
    base: 0x20000000
    range: 0x20000000
    description: SRAM memory region
  - slave: periph_rd/periph_wr (Slave 2 - AXI4)
    base: 0x40000000
    range: 0x20000000
    description: Peripheral region
  - slave: apb0 (Slave 3 - APB)
    base: 0x60000000
    range: 0x20000000
    description: APB peripheral region
  - slave: axil_periph (Slave 4 - AXIL)
    base: 0x80000000
    range: 0x80000000
    description: AXI4-Lite peripheral region (requires AXI4→AXIL conversion)

# Functional scenarios
functional_scenarios:
  - id: BRIDGE-1x5-01
    name: "Five-way address routing"
    description: Single master routes to any of five slaves (4 AXI4 + 1 AXIL)
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - Five-way address decode
      - Master to AXI4 slave 0/1/2/3 routing
      - Master to AXIL slave 4 routing
    priority: high
    status: verified

  - id: BRIDGE-1x5-02
    name: "AXI4 slave routing"
    description: Verify AR/R or AW/W/B channels to AXI4 slaves
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4 channel routing to slaves 0/1/2/3
      - Native AXI4 protocol maintained
      - Full burst support
    priority: high
    status: verified

  - id: BRIDGE-1x5-03
    name: "AXIL protocol conversion"
    description: AXI4 to AXI4-Lite conversion for slave 4
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4→AXIL address conversion
      - AXI4→AXIL data conversion
      - Burst split (AXI4 bursts → AXIL single beats)
      - AXIL response aggregation
    priority: high
    status: partial
    notes: AXIL converter placeholder exists, full implementation pending Phase 3

  - id: BRIDGE-1x5-04
    name: "Mixed protocol transaction sequence"
    description: Alternate between AXI4, APB, and AXIL slaves
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4 → APB → AXIL → AXI4 sequence
      - Protocol switching overhead
      - State machine transitions
    priority: medium
    status: partial
    notes: Requires APB and AXIL converter completion

  - id: BRIDGE-1x5-05
    name: "Burst handling for AXIL"
    description: AXI4 bursts converted to AXIL single beats
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - Burst split to AXIL slave
      - AXIL sequential addressing
      - Response aggregation back to AXI4
    priority: high
    status: partial
    notes: Requires AXIL converter completion

  - id: BRIDGE-1x5-06
    name: "Transaction ID preservation"
    description: Verify ID signals for AXI4 slaves, ID handling for APB/AXIL
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - ID forwarding to AXI4 slaves (0/1/2/3)
      - ID regeneration for APB slave (3)
      - ID regeneration for AXIL slave (4)
      - ID matching on responses
    priority: high
    status: verified

  - id: BRIDGE-1x5-07
    name: "Address decode boundaries"
    description: Five slave region boundaries
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - Slave 0/1 boundary (0x1FFFFFFF/0x20000000)
      - Slave 1/2 boundary (0x3FFFFFFF/0x40000000)
      - Slave 2/3 boundary (0x5FFFFFFF/0x60000000)
      - Slave 3/4 boundary (0x7FFFFFFF/0x80000000) - APB/AXIL transition
    priority: medium
    status: verified

  - id: BRIDGE-1x5-08
    name: "Backpressure per slave"
    description: Independent backpressure from each slave
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4 slave ready propagation (slaves 0/1/2/3)
      - AXIL slave ready propagation (slave 4)
    priority: high
    status: verified

  - id: BRIDGE-1x5-09
    name: "Response codes from all slaves"
    description: OKAY/SLVERR from AXI4, APB, and AXIL slaves
    test_function: "cocotb_test_basic_connectivity"
    covers_features:
      - AXI4 response codes (RRESP/BRESP)
      - APB response codes (PSLVERR)
      - AXIL response codes
      - Response code translation
    priority: high
    status: partial
    notes: AXIL response handling pending converter completion

# Parameter combinations tested
parameter_coverage:
  - variant: rd
    ADDR_WIDTH: 32
    DATA_WIDTH: 32
    ID_WIDTH: 4
    test_level: basic
    status: verified
    notes: AXI4 slaves fully tested, APB/AXIL slaves placeholder

  - variant: wr
    ADDR_WIDTH: 32
    DATA_WIDTH: 32
    ID_WIDTH: 4
    test_level: basic
    status: verified
    notes: AXI4 slaves fully tested, APB/AXIL slaves placeholder

# Implied coverage calculation
implied_coverage:
  total_scenarios: 9
  verified_scenarios: 5
  partial_scenarios: 4
  implied_percentage: 55.6
  notes: |
    AXI4 routing scenarios (5/9) fully verified.
    APB/AXIL-related scenarios (4/9) partially implemented with placeholder converters.
    Full coverage requires Phase 3 converter implementation.

notes: |
  Bridge 1x5 introduces AXI4-Lite protocol support in addition to APB.
  Available in two channel variants:
  - bridge_1x5_rd: Read-only channels (AR, R)
  - bridge_1x5_wr: Write-only channels (AW, W, B)

  Key features:
  - Five-way address decode
  - Mixed AXI4/APB/AXIL protocol support
  - APB converter placeholder (Phase 3)
  - AXIL converter placeholder (Phase 3)
  - Burst split for AXIL slaves
  - Tests multi-protocol conversion architecture

  Current status:
  - AXI4 slave routing (slaves 0/1/2/3): FULLY VERIFIED
  - APB slave routing (slave 3): PLACEHOLDER ONLY
  - AXIL slave routing (slave 4): PLACEHOLDER ONLY
  - APB converter: TODO (Phase 3)
  - AXIL converter: TODO (Phase 3)

  Test coverage:
  - Five-way routing verified for AXI4 slaves
  - APB/AXIL slave routing structure exists but converters not implemented
  - Transaction ID handling verified for AXI4 paths
  - Address boundaries verified including protocol transition points
  - Backpressure verified for AXI4 slaves
  - Response codes verified for AXI4 paths

  Gap analysis:
  - AXIL protocol conversion needs Phase 3 completion
  - APB protocol conversion needs Phase 3 completion
  - Mixed protocol transaction sequences need full converter support
  - Burst split to AXIL needs converter implementation
  - AXIL/APB-specific response handling pending
