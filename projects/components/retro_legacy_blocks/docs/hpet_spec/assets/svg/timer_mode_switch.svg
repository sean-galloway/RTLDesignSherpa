<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: timer_mode_switch Pages: 1 -->
<svg width="901pt" height="874pt"
 viewBox="0.00 0.00 900.50 873.74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 869.74)">
<title>timer_mode_switch</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-869.74 896.5,-869.74 896.5,4 -4,4"/>
<!-- start -->
<g id="node1" class="node">
<title>start</title>
<ellipse fill="lightyellow" stroke="black" cx="313" cy="-838.87" rx="111.95" ry="26.74"/>
<text text-anchor="middle" x="313" y="-842.67" font-family="Arial" font-size="14.00">Timer Running</text>
<text text-anchor="middle" x="313" y="-827.67" font-family="Arial" font-size="14.00">(Want to change mode)</text>
</g>
<!-- check_current -->
<g id="node3" class="node">
<title>check_current</title>
<path fill="lightblue" stroke="black" d="M410.5,-775C410.5,-775 215.5,-775 215.5,-775 209.5,-775 203.5,-769 203.5,-763 203.5,-763 203.5,-734 203.5,-734 203.5,-728 209.5,-722 215.5,-722 215.5,-722 410.5,-722 410.5,-722 416.5,-722 422.5,-728 422.5,-734 422.5,-734 422.5,-763 422.5,-763 422.5,-769 416.5,-775 410.5,-775"/>
<text text-anchor="middle" x="313" y="-759.8" font-family="Arial" font-size="14.00">Read Current Mode</text>
<text text-anchor="middle" x="313" y="-744.8" font-family="Arial" font-size="14.00">config = READ(TIMER_CONFIG)</text>
<text text-anchor="middle" x="313" y="-729.8" font-family="Arial" font-size="14.00">Check bit[2] (type)</text>
</g>
<!-- start&#45;&gt;check_current -->
<g id="edge1" class="edge">
<title>start&#45;&gt;check_current</title>
<path fill="none" stroke="black" d="M313,-811.83C313,-803.49 313,-794.1 313,-785.19"/>
<polygon fill="black" stroke="black" points="316.5,-785.05 313,-775.05 309.5,-785.05 316.5,-785.05"/>
</g>
<!-- end -->
<g id="node2" class="node">
<title>end</title>
<ellipse fill="lightgreen" stroke="black" cx="234" cy="-18" rx="79.09" ry="18"/>
<text text-anchor="middle" x="234" y="-14.3" font-family="Arial" font-size="14.00">New Mode Active</text>
</g>
<!-- current_mode -->
<g id="node4" class="node">
<title>current_mode</title>
<path fill="lightyellow" stroke="black" d="M301.2,-682.84C301.2,-682.84 226.6,-669.16 226.6,-669.16 220.7,-668.08 220.7,-665.92 226.6,-664.84 226.6,-664.84 301.2,-651.16 301.2,-651.16 307.1,-650.08 318.9,-650.08 324.8,-651.16 324.8,-651.16 399.4,-664.84 399.4,-664.84 405.3,-665.92 405.3,-668.08 399.4,-669.16 399.4,-669.16 324.8,-682.84 324.8,-682.84 318.9,-683.92 307.1,-683.92 301.2,-682.84"/>
<text text-anchor="middle" x="313" y="-663.3" font-family="Arial" font-size="14.00">Current mode?</text>
</g>
<!-- check_current&#45;&gt;current_mode -->
<g id="edge2" class="edge">
<title>check_current&#45;&gt;current_mode</title>
<path fill="none" stroke="black" d="M313,-721.91C313,-713.48 313,-704.08 313,-695.52"/>
<polygon fill="black" stroke="black" points="316.5,-695.26 313,-685.26 309.5,-695.26 316.5,-695.26"/>
</g>
<!-- from_oneshot -->
<g id="node5" class="node">
<title>from_oneshot</title>
<path fill="lightcyan" stroke="black" d="M292.5,-598C292.5,-598 173.5,-598 173.5,-598 167.5,-598 161.5,-592 161.5,-586 161.5,-586 161.5,-572 161.5,-572 161.5,-566 167.5,-560 173.5,-560 173.5,-560 292.5,-560 292.5,-560 298.5,-560 304.5,-566 304.5,-572 304.5,-572 304.5,-586 304.5,-586 304.5,-592 298.5,-598 292.5,-598"/>
<text text-anchor="middle" x="233" y="-582.8" font-family="Arial" font-size="14.00">Change:</text>
<text text-anchor="middle" x="233" y="-567.8" font-family="Arial" font-size="14.00">One&#45;shot → Periodic</text>
</g>
<!-- current_mode&#45;&gt;from_oneshot -->
<g id="edge3" class="edge">
<title>current_mode&#45;&gt;from_oneshot</title>
<path fill="none" stroke="black" d="M298.65,-651.47C292.54,-645.22 285.37,-637.8 279,-631 271.34,-622.82 263.11,-613.77 255.75,-605.6"/>
<polygon fill="black" stroke="black" points="258.3,-603.2 249.02,-598.09 253.09,-607.87 258.3,-603.2"/>
<text text-anchor="middle" x="317.5" y="-619.8" font-family="Arial" font-size="14.00">One&#45;shot (0)</text>
</g>
<!-- from_periodic -->
<g id="node6" class="node">
<title>from_periodic</title>
<path fill="lightcyan" stroke="black" d="M460.5,-598C460.5,-598 341.5,-598 341.5,-598 335.5,-598 329.5,-592 329.5,-586 329.5,-586 329.5,-572 329.5,-572 329.5,-566 335.5,-560 341.5,-560 341.5,-560 460.5,-560 460.5,-560 466.5,-560 472.5,-566 472.5,-572 472.5,-572 472.5,-586 472.5,-586 472.5,-592 466.5,-598 460.5,-598"/>
<text text-anchor="middle" x="401" y="-582.8" font-family="Arial" font-size="14.00">Change:</text>
<text text-anchor="middle" x="401" y="-567.8" font-family="Arial" font-size="14.00">Periodic → One&#45;shot</text>
</g>
<!-- current_mode&#45;&gt;from_periodic -->
<g id="edge4" class="edge">
<title>current_mode&#45;&gt;from_periodic</title>
<path fill="none" stroke="black" d="M331.56,-651.99C339.35,-645.83 348.37,-638.34 356,-631 364.13,-623.19 372.46,-614.11 379.7,-605.79"/>
<polygon fill="black" stroke="black" points="382.42,-607.99 386.27,-598.12 377.11,-603.44 382.42,-607.99"/>
<text text-anchor="middle" x="405" y="-619.8" font-family="Arial" font-size="14.00">Periodic (1)</text>
</g>
<!-- disable_timer1 -->
<g id="node7" class="node">
<title>disable_timer1</title>
<path fill="lightblue" stroke="black" d="M277.5,-523C277.5,-523 98.5,-523 98.5,-523 92.5,-523 86.5,-517 86.5,-511 86.5,-511 86.5,-497 86.5,-497 86.5,-491 92.5,-485 98.5,-485 98.5,-485 277.5,-485 277.5,-485 283.5,-485 289.5,-491 289.5,-497 289.5,-497 289.5,-511 289.5,-511 289.5,-517 283.5,-523 277.5,-523"/>
<text text-anchor="middle" x="188" y="-507.8" font-family="Arial" font-size="14.00">1. Disable Timer</text>
<text text-anchor="middle" x="188" y="-492.8" font-family="Arial" font-size="14.00">WRITE(TIMER_CONFIG, 0x0)</text>
</g>
<!-- from_oneshot&#45;&gt;disable_timer1 -->
<g id="edge5" class="edge">
<title>from_oneshot&#45;&gt;disable_timer1</title>
<path fill="none" stroke="black" d="M221.88,-559.96C216.63,-551.44 210.26,-541.12 204.47,-531.72"/>
<polygon fill="black" stroke="black" points="207.38,-529.77 199.15,-523.09 201.42,-533.44 207.38,-529.77"/>
</g>
<!-- disable_timer2 -->
<g id="node11" class="node">
<title>disable_timer2</title>
<path fill="lightblue" stroke="black" d="M500.5,-523C500.5,-523 321.5,-523 321.5,-523 315.5,-523 309.5,-517 309.5,-511 309.5,-511 309.5,-497 309.5,-497 309.5,-491 315.5,-485 321.5,-485 321.5,-485 500.5,-485 500.5,-485 506.5,-485 512.5,-491 512.5,-497 512.5,-497 512.5,-511 512.5,-511 512.5,-517 506.5,-523 500.5,-523"/>
<text text-anchor="middle" x="411" y="-507.8" font-family="Arial" font-size="14.00">1. Disable Timer</text>
<text text-anchor="middle" x="411" y="-492.8" font-family="Arial" font-size="14.00">WRITE(TIMER_CONFIG, 0x0)</text>
</g>
<!-- from_periodic&#45;&gt;disable_timer2 -->
<g id="edge10" class="edge">
<title>from_periodic&#45;&gt;disable_timer2</title>
<path fill="none" stroke="black" d="M403.47,-559.96C404.58,-551.88 405.91,-542.18 407.14,-533.18"/>
<polygon fill="black" stroke="black" points="410.63,-533.47 408.52,-523.09 403.7,-532.52 410.63,-533.47"/>
</g>
<!-- clear_irq1 -->
<g id="node8" class="node">
<title>clear_irq1</title>
<path fill="lightblue" stroke="black" d="M267,-448C267,-448 91,-448 91,-448 85,-448 79,-442 79,-436 79,-436 79,-422 79,-422 79,-416 85,-410 91,-410 91,-410 267,-410 267,-410 273,-410 279,-416 279,-422 279,-422 279,-436 279,-436 279,-442 273,-448 267,-448"/>
<text text-anchor="middle" x="179" y="-432.8" font-family="Arial" font-size="14.00">2. Clear IRQ (if any)</text>
<text text-anchor="middle" x="179" y="-417.8" font-family="Arial" font-size="14.00">WRITE(HPET_STATUS, 1&lt;&lt;i)</text>
</g>
<!-- disable_timer1&#45;&gt;clear_irq1 -->
<g id="edge6" class="edge">
<title>disable_timer1&#45;&gt;clear_irq1</title>
<path fill="none" stroke="black" d="M185.78,-484.96C184.78,-476.88 183.58,-467.18 182.47,-458.18"/>
<polygon fill="black" stroke="black" points="185.93,-457.59 181.23,-448.09 178.98,-458.44 185.93,-457.59"/>
</g>
<!-- set_comparator1 -->
<g id="node9" class="node">
<title>set_comparator1</title>
<path fill="lightblue" stroke="black" d="M272,-365.5C272,-365.5 12,-365.5 12,-365.5 6,-365.5 0,-359.5 0,-353.5 0,-353.5 0,-324.5 0,-324.5 0,-318.5 6,-312.5 12,-312.5 12,-312.5 272,-312.5 272,-312.5 278,-312.5 284,-318.5 284,-324.5 284,-324.5 284,-353.5 284,-353.5 284,-359.5 278,-365.5 272,-365.5"/>
<text text-anchor="middle" x="142" y="-350.3" font-family="Arial" font-size="14.00">3. Set Comparator</text>
<text text-anchor="middle" x="142" y="-335.3" font-family="Arial" font-size="14.00">WRITE(TIMER_COMPARATOR_LO, value)</text>
<text text-anchor="middle" x="142" y="-320.3" font-family="Arial" font-size="14.00">(This becomes period)</text>
</g>
<!-- clear_irq1&#45;&gt;set_comparator1 -->
<g id="edge7" class="edge">
<title>clear_irq1&#45;&gt;set_comparator1</title>
<path fill="none" stroke="black" d="M171.33,-409.77C167.09,-399.68 161.68,-386.8 156.65,-374.85"/>
<polygon fill="black" stroke="black" points="159.85,-373.41 152.74,-365.55 153.39,-376.13 159.85,-373.41"/>
</g>
<!-- enable_periodic -->
<g id="node10" class="node">
<title>enable_periodic</title>
<path fill="lightblue" stroke="black" d="M291.5,-197C291.5,-197 112.5,-197 112.5,-197 106.5,-197 100.5,-191 100.5,-185 100.5,-185 100.5,-156 100.5,-156 100.5,-150 106.5,-144 112.5,-144 112.5,-144 291.5,-144 291.5,-144 297.5,-144 303.5,-150 303.5,-156 303.5,-156 303.5,-185 303.5,-185 303.5,-191 297.5,-197 291.5,-197"/>
<text text-anchor="middle" x="202" y="-181.8" font-family="Arial" font-size="14.00">4. Enable Periodic Mode</text>
<text text-anchor="middle" x="202" y="-166.8" font-family="Arial" font-size="14.00">WRITE(TIMER_CONFIG, 0x7)</text>
<text text-anchor="middle" x="202" y="-151.8" font-family="Arial" font-size="14.00">(enable|int_en|periodic)</text>
</g>
<!-- set_comparator1&#45;&gt;enable_periodic -->
<g id="edge8" class="edge">
<title>set_comparator1&#45;&gt;enable_periodic</title>
<path fill="none" stroke="black" d="M151.24,-312.35C161.42,-284.12 177.84,-238.55 189.24,-206.92"/>
<polygon fill="black" stroke="black" points="192.65,-207.77 192.75,-197.18 186.06,-205.4 192.65,-207.77"/>
</g>
<!-- enable_periodic&#45;&gt;end -->
<g id="edge9" class="edge">
<title>enable_periodic&#45;&gt;end</title>
<path fill="none" stroke="black" d="M207.43,-143.97C213.22,-116.75 222.34,-73.83 228.25,-46.05"/>
<polygon fill="black" stroke="black" points="231.69,-46.71 230.34,-36.2 224.84,-45.26 231.69,-46.71"/>
</g>
<!-- clear_irq2 -->
<g id="node12" class="node">
<title>clear_irq2</title>
<path fill="lightblue" stroke="black" d="M500,-448C500,-448 324,-448 324,-448 318,-448 312,-442 312,-436 312,-436 312,-422 312,-422 312,-416 318,-410 324,-410 324,-410 500,-410 500,-410 506,-410 512,-416 512,-422 512,-422 512,-436 512,-436 512,-442 506,-448 500,-448"/>
<text text-anchor="middle" x="412" y="-432.8" font-family="Arial" font-size="14.00">2. Clear IRQ (if any)</text>
<text text-anchor="middle" x="412" y="-417.8" font-family="Arial" font-size="14.00">WRITE(HPET_STATUS, 1&lt;&lt;i)</text>
</g>
<!-- disable_timer2&#45;&gt;clear_irq2 -->
<g id="edge11" class="edge">
<title>disable_timer2&#45;&gt;clear_irq2</title>
<path fill="none" stroke="black" d="M411.25,-484.96C411.36,-476.88 411.49,-467.18 411.61,-458.18"/>
<polygon fill="black" stroke="black" points="415.11,-458.14 411.75,-448.09 408.12,-458.04 415.11,-458.14"/>
</g>
<!-- reset_counter_option -->
<g id="node13" class="node">
<title>reset_counter_option</title>
<path fill="lightyellow" stroke="black" d="M512,-365.5C512,-365.5 314,-365.5 314,-365.5 308,-365.5 302,-359.5 302,-353.5 302,-353.5 302,-324.5 302,-324.5 302,-318.5 308,-312.5 314,-312.5 314,-312.5 512,-312.5 512,-312.5 518,-312.5 524,-318.5 524,-324.5 524,-324.5 524,-353.5 524,-353.5 524,-359.5 518,-365.5 512,-365.5"/>
<text text-anchor="middle" x="413" y="-350.3" font-family="Arial" font-size="14.00">3. Optional: Reset Counter</text>
<text text-anchor="middle" x="413" y="-335.3" font-family="Arial" font-size="14.00">WRITE(HPET_COUNTER_LO, 0)</text>
<text text-anchor="middle" x="413" y="-320.3" font-family="Arial" font-size="14.00">WRITE(HPET_COUNTER_HI, 0)</text>
</g>
<!-- clear_irq2&#45;&gt;reset_counter_option -->
<g id="edge12" class="edge">
<title>clear_irq2&#45;&gt;reset_counter_option</title>
<path fill="none" stroke="black" d="M412.21,-409.77C412.32,-399.88 412.46,-387.3 412.6,-375.57"/>
<polygon fill="black" stroke="black" points="416.1,-375.59 412.71,-365.55 409.1,-375.51 416.1,-375.59"/>
</g>
<!-- set_comparator2 -->
<g id="node14" class="node">
<title>set_comparator2</title>
<path fill="lightblue" stroke="black" d="M517,-268C517,-268 257,-268 257,-268 251,-268 245,-262 245,-256 245,-256 245,-227 245,-227 245,-221 251,-215 257,-215 257,-215 517,-215 517,-215 523,-215 529,-221 529,-227 529,-227 529,-256 529,-256 529,-262 523,-268 517,-268"/>
<text text-anchor="middle" x="387" y="-252.8" font-family="Arial" font-size="14.00">4. Set Comparator</text>
<text text-anchor="middle" x="387" y="-237.8" font-family="Arial" font-size="14.00">WRITE(TIMER_COMPARATOR_LO, value)</text>
<text text-anchor="middle" x="387" y="-222.8" font-family="Arial" font-size="14.00">(Fire time, not period)</text>
</g>
<!-- reset_counter_option&#45;&gt;set_comparator2 -->
<g id="edge13" class="edge">
<title>reset_counter_option&#45;&gt;set_comparator2</title>
<path fill="none" stroke="black" d="M406.03,-312.41C403.15,-301.81 399.75,-289.34 396.64,-277.89"/>
<polygon fill="black" stroke="black" points="399.99,-276.89 393.99,-268.16 393.24,-278.73 399.99,-276.89"/>
</g>
<!-- enable_oneshot -->
<g id="node15" class="node">
<title>enable_oneshot</title>
<path fill="lightblue" stroke="black" d="M458.5,-126C458.5,-126 279.5,-126 279.5,-126 273.5,-126 267.5,-120 267.5,-114 267.5,-114 267.5,-85 267.5,-85 267.5,-79 273.5,-73 279.5,-73 279.5,-73 458.5,-73 458.5,-73 464.5,-73 470.5,-79 470.5,-85 470.5,-85 470.5,-114 470.5,-114 470.5,-120 464.5,-126 458.5,-126"/>
<text text-anchor="middle" x="369" y="-110.8" font-family="Arial" font-size="14.00">5. Enable One&#45;Shot Mode</text>
<text text-anchor="middle" x="369" y="-95.8" font-family="Arial" font-size="14.00">WRITE(TIMER_CONFIG, 0x3)</text>
<text text-anchor="middle" x="369" y="-80.8" font-family="Arial" font-size="14.00">(enable|int_en)</text>
</g>
<!-- set_comparator2&#45;&gt;enable_oneshot -->
<g id="edge14" class="edge">
<title>set_comparator2&#45;&gt;enable_oneshot</title>
<path fill="none" stroke="black" d="M383.7,-214.82C380.86,-192.72 376.73,-160.6 373.57,-136.03"/>
<polygon fill="black" stroke="black" points="377.03,-135.49 372.28,-126.02 370.08,-136.38 377.03,-135.49"/>
</g>
<!-- enable_oneshot&#45;&gt;end -->
<g id="edge15" class="edge">
<title>enable_oneshot&#45;&gt;end</title>
<path fill="none" stroke="black" d="M325.54,-72.91C307.72,-62.41 287.33,-50.41 270.32,-40.39"/>
<polygon fill="black" stroke="black" points="271.65,-37.11 261.26,-35.05 268.1,-43.14 271.65,-37.11"/>
</g>
<!-- note1 -->
<g id="node16" class="node">
<title>note1</title>
<polygon fill="red" stroke="black" points="700,-523 530,-523 530,-485 706,-485 706,-517 700,-523"/>
<polyline fill="none" stroke="black" points="700,-523 700,-517 "/>
<polyline fill="none" stroke="black" points="706,-517 700,-517 "/>
<text text-anchor="middle" x="618" y="-507.8" font-family="Arial" font-size="14.00" fill="white">CRITICAL: Always disable</text>
<text text-anchor="middle" x="618" y="-492.8" font-family="Arial" font-size="14.00" fill="white">timer before mode change</text>
</g>
<!-- note2 -->
<g id="node17" class="node">
<title>note2</title>
<polygon fill="yellow" stroke="black" points="717.5,-373 542.5,-373 542.5,-305 723.5,-305 723.5,-367 717.5,-373"/>
<polyline fill="none" stroke="black" points="717.5,-373 717.5,-367 "/>
<polyline fill="none" stroke="black" points="723.5,-367 717.5,-367 "/>
<text text-anchor="middle" x="633" y="-357.8" font-family="Arial" font-size="14.00">Note: Comparator meaning</text>
<text text-anchor="middle" x="633" y="-342.8" font-family="Arial" font-size="14.00">changes with mode:</text>
<text text-anchor="middle" x="633" y="-327.8" font-family="Arial" font-size="14.00">• One&#45;shot: Fire time</text>
<text text-anchor="middle" x="633" y="-312.8" font-family="Arial" font-size="14.00">• Periodic: Period</text>
</g>
<!-- note3 -->
<g id="node18" class="node">
<title>note3</title>
<polygon fill="lightyellow" stroke="black" points="886.5,-365.5 741.5,-365.5 741.5,-312.5 892.5,-312.5 892.5,-359.5 886.5,-365.5"/>
<polyline fill="none" stroke="black" points="886.5,-365.5 886.5,-359.5 "/>
<polyline fill="none" stroke="black" points="892.5,-359.5 886.5,-359.5 "/>
<text text-anchor="middle" x="817" y="-350.3" font-family="Arial" font-size="14.00">Best Practice: Reset</text>
<text text-anchor="middle" x="817" y="-335.3" font-family="Arial" font-size="14.00">counter for predictable</text>
<text text-anchor="middle" x="817" y="-320.3" font-family="Arial" font-size="14.00">one&#45;shot timing</text>
</g>
</g>
</svg>
