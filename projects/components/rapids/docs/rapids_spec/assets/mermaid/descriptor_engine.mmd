graph TB
    subgraph "Descriptor Engine"
        subgraph "Input Interfaces"
            APB_IN[APB Interface<br/>apb_valid/addr] --> REQ_ARB
            RDA_IN[RDA Packets<br/>rda_valid/packet/channel] --> REQ_ARB
            CFG_IN[Configuration<br/>cfg_prefetch_enable<br/>cfg_fifo_threshold] --> FSM
        end

        subgraph "Request Arbitration"
            REQ_ARB[Request Arbiter<br/>RDA Priority] --> |selected_request| FSM
        end

        subgraph "Descriptor FSM (6 States)"
            FSM[Main FSM] --> |DESC_IDLE| IDLE[Wait for Request]
            FSM --> |DESC_CHECK_FIFO| CHECK[Check FIFO Space]
            FSM --> |DESC_ISSUE_READ| ISSUE[Issue AXI Read]
            FSM --> |DESC_WAIT_READ| WAIT[Wait for Response]
            FSM --> |DESC_PARSE| PARSE[Parse 512-bit Data]
            FSM --> |DESC_OUTPUT| OUTPUT[Push to FIFO]
        end

        subgraph "AXI Read Path"
            FSM --> |ar_valid/addr/len| AR_CH[AR Channel]
            AR_CH --> |ar_ready| FSM
            R_CH[R Channel] --> |r_valid/data/last| FSM
            FSM --> |r_ready| R_CH
        end

        subgraph "Descriptor Parsing"
            PARSE --> |extract fields| FIELDS[Field Extraction<br/>src_addr, dst_addr<br/>length, type<br/>eos_flags, next_ptr]
            FIELDS --> |256-bit descriptor| FIFO
        end

        subgraph "Output FIFO"
            FIFO[4-Deep FIFO<br/>256-bit descriptors] --> |descriptor_valid| DESC_OUT
            FIFO --> |fifo_level| PREFETCH[Prefetch Logic]
            PREFETCH --> |prefetch_request| FSM
        end

        subgraph "Output Interface"
            DESC_OUT[Descriptor Output<br/>descriptor_ready] --> SCHED[To Scheduler]
            FSM --> |mon_valid/packet| MON_OUT[MonBus Events]
            FSM --> |descriptor_engine_idle| STATUS[Status]
        end
    end

    style FSM fill:#f9f,stroke:#333,stroke-width:3px
    style REQ_ARB fill:#bfb,stroke:#333,stroke-width:2px
    style FIFO fill:#ffb,stroke:#333,stroke-width:2px
