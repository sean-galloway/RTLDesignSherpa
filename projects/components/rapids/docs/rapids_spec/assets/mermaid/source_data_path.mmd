graph TB
    subgraph "Source Data Path (Memory to Network)"
        subgraph "AXI Read Engine"
            subgraph "Channel Arbitration"
                SCHED_IN[Scheduler Interface<br/>data_valid/addr/len<br/>per channel] --> ARB_REQ[Arbiter Request]
                SPACE[SRAM Space Check<br/>Preallocation] --> ARB_REQ
                OUT_LIM[Outstanding Limit] --> ARB_REQ
                ARB_REQ --> ARB[Round-Robin Arbiter]
                ARB --> |grant_id| AR_MUX[AR Channel Mux]
            end

            subgraph "AR Channel"
                AR_MUX --> |ar_valid/addr/len/id| AR_CH[AR Channel]
                AR_CH --> MEM[System Memory]
                AR_MUX --> |alloc_req| PREALLOC[SRAM Preallocation]
            end

            subgraph "R Channel"
                MEM --> |r_valid/data/last/id| R_CH[R Channel]
                R_CH --> |rd_data| SRC_SRAM
                R_CH --> |r_last| OUT_CNT[Outstanding Counter]
                OUT_CNT --> OUT_LIM
            end

            subgraph "Completion Tracking"
                AR_MUX --> |done_strobe| DONE_GEN[Done Generator]
                DONE_GEN --> |per_channel| SCHED_OUT[To Scheduler]
            end

            ARB --> |mon_events| MON_AGG
        end

        subgraph "Source SRAM Control"
            SRC_SRAM[SRAM Controller<br/>32 Channels] --> |wr_data| SRAM[Multi-Channel SRAM<br/>Per-Channel Buffers]
            PREALLOC --> SRC_SRAM
            SRAM --> |rd_data| TX_MUX[TX Data Mux]

            subgraph "Per-Channel Management"
                WR_PTR[Write Pointers<br/>32 channels] --> SRC_SRAM
                RD_PTR[Read Pointers<br/>32 channels] --> SRC_SRAM
                LEVEL[Level Counters<br/>32 channels] --> |space_free| SPACE
            end

            SRC_SRAM --> |mon_events| MON_AGG
        end

        subgraph "AXIS Master Interface"
            subgraph "TX Arbitration"
                SRAM_LEVEL[SRAM Data Available] --> TX_ARB[TX Arbiter]
                TX_ARB --> |grant_id| TX_MUX
            end

            TX_MUX --> |tdata/tstrb/tlast| AXIS_TX[AXIS TX<br/>tvalid/tready]
            AXIS_TX --> |backpressure| TX_ARB
            TX_ARB --> |mon_events| MON_AGG
        end

        subgraph "Monitor Aggregation"
            MON_AGG[MonBus Arbiter<br/>3 Sources] --> MON_OUT[MonBus Output]
        end
    end

    style SRC_SRAM fill:#ffb,stroke:#333,stroke-width:2px
    style ARB fill:#f9f,stroke:#333,stroke-width:3px
    style TX_ARB fill:#bbf,stroke:#333,stroke-width:2px
    style MON_AGG fill:#bfb,stroke:#333,stroke-width:2px
