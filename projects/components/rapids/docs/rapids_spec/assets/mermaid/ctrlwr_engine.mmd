graph TB
    subgraph "Control Write Engine"
        subgraph "Input Interface"
            SCHED_IN[Scheduler Interface<br/>ctrlwr_valid<br/>ctrlwr_addr<br/>ctrlwr_data] --> FSM
            CFG_IN[Configuration<br/>cfg_timeout] --> FSM
        end

        subgraph "Control Write FSM (4 States)"
            FSM[Main FSM] --> |CTRLWR_IDLE| IDLE[Wait for Request]
            FSM --> |CTRLWR_ISSUE_AW| ISSUE_AW[Issue AW Channel]
            FSM --> |CTRLWR_ISSUE_W| ISSUE_W[Issue W Channel]
            FSM --> |CTRLWR_WAIT_B| WAIT_B[Wait for B Response]
        end

        subgraph "AXI Write Path"
            FSM --> |aw_valid/addr| AW_CH[AW Channel<br/>Single Beat Write]
            AW_CH --> |aw_ready| FSM
            FSM --> |w_valid/data/strb/last| W_CH[W Channel<br/>32-bit Data]
            W_CH --> |w_ready| FSM
            B_CH[B Channel<br/>b_valid/resp] --> FSM
            FSM --> |b_ready| B_CH
        end

        subgraph "Response Handling"
            FSM --> |check_resp| RESP_CHK[Response Check<br/>OKAY vs Error]
            RESP_CHK --> |error| ERROR_OUT
            RESP_CHK --> |success| DONE_OUT
        end

        subgraph "Timeout Handling"
            FSM --> |start_timer| TIMEOUT[Timeout Counter]
            TIMEOUT --> |timeout_expired| FSM
        end

        subgraph "Output Interface"
            DONE_OUT[ctrlwr_ready] --> SCHED_OUT[To Scheduler]
            ERROR_OUT[ctrlwr_error] --> SCHED_OUT
            FSM --> |mon_valid/packet| MON_OUT[MonBus Events]
        end
    end

    AW_CH --> MEM[System Memory]
    W_CH --> MEM
    MEM --> B_CH

    style FSM fill:#f9f,stroke:#333,stroke-width:3px
    style RESP_CHK fill:#bfb,stroke:#333,stroke-width:2px
    style TIMEOUT fill:#ffb,stroke:#333,stroke-width:2px
