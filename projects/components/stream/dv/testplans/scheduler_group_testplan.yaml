# Testplan for scheduler_group
# Maps functional test scenarios to Verilator coverage points

module: scheduler_group
rtl_file: projects/components/stream/rtl/macro/scheduler_group.sv
test_file: "GAP - Integration tested only"

# Module description:
# Scheduler group combines descriptor_engine and scheduler for single channel.
# Manages descriptor fetch, parsing, and transfer scheduling for one DMA channel.
# NOTE: This module is integration-tested via stream_core, no direct macro test.

parameters:
  - name: DATA_WIDTH
    default: 512
    description: Data path width
  - name: ADDR_WIDTH
    default: 64
    description: Address bus width
  - name: ID_WIDTH
    default: 8
    description: AXI ID width

# Coverage points
coverage_points:
  - line: 30
    type: input_port
    content: "input clk"
    covered: true

  - line: 31
    type: input_port
    content: "input rst_n"
    covered: true

  - line: 34
    type: input_port
    content: "input desc_apb_valid"
    covered: true

  - line: 35
    type: output_port
    content: "output desc_apb_ready"
    covered: true

  - line: 36
    type: input_port
    content: "input desc_apb_addr"
    covered: true

  - line: 39
    type: output_port
    content: "output m_axi_desc_araddr"
    covered: true

  - line: 40
    type: output_port
    content: "output m_axi_desc_arvalid"
    covered: true

  - line: 41
    type: input_port
    content: "input m_axi_desc_arready"
    covered: true

  - line: 42
    type: input_port
    content: "input m_axi_desc_rdata"
    covered: true

  - line: 43
    type: input_port
    content: "input m_axi_desc_rvalid"
    covered: true

  - line: 44
    type: output_port
    content: "output m_axi_desc_rready"
    covered: true

  - line: 47
    type: output_port
    content: "output rd_req_valid"
    covered: true

  - line: 48
    type: input_port
    content: "input rd_req_ready"
    covered: true

  - line: 49
    type: output_port
    content: "output rd_req_addr"
    covered: true

  - line: 50
    type: output_port
    content: "output rd_req_length"
    covered: true

  - line: 53
    type: output_port
    content: "output wr_req_valid"
    covered: true

  - line: 54
    type: input_port
    content: "input wr_req_ready"
    covered: true

  - line: 55
    type: output_port
    content: "output wr_req_addr"
    covered: true

  - line: 56
    type: output_port
    content: "output wr_req_length"
    covered: true

  - line: 59
    type: input_port
    content: "input rd_done_strobe"
    covered: true

  - line: 60
    type: input_port
    content: "input wr_done_strobe"
    covered: true

  - line: 63
    type: output_port
    content: "output completion_valid"
    covered: true

  - line: 64
    type: output_port
    content: "output completion_data"
    covered: true

# Functional scenarios (Integration Testing)
functional_scenarios:
  - id: SCHED-GRP-01
    name: "Single channel descriptor flow"
    description: APB kick-off → descriptor fetch → parse → read req → write req → complete
    test_function: "test_stream_core (gate)"
    covers_lines: [34, 35, 36, 39, 40, 41, 42, 43, 44, 47, 48, 49, 50, 53, 54, 55, 56, 59, 60, 63, 64]
    priority: high
    status: integration_tested
    note: "Tested via stream_core single channel test"

  - id: SCHED-GRP-02
    name: "Descriptor chain processing"
    description: Follow next_descriptor_ptr chain
    test_function: "test_stream_core (func)"
    covers_lines: [34, 35, 39, 40, 42, 43, 47, 53, 63]
    priority: high
    status: integration_tested

  - id: SCHED-GRP-03
    name: "Descriptor engine backpressure"
    description: Scheduler not ready for descriptor (desc_ready = 0)
    test_function: "test_stream_core (func)"
    covers_lines: [40, 41, 44]
    priority: high
    status: integration_tested

  - id: SCHED-GRP-04
    name: "Read engine backpressure"
    description: Read engine not ready (rd_req_ready = 0)
    test_function: "test_stream_core (medium)"
    covers_lines: [47, 48]
    priority: high
    status: integration_tested

  - id: SCHED-GRP-05
    name: "Write engine backpressure"
    description: Write engine not ready (wr_req_ready = 0)
    test_function: "test_stream_core (medium)"
    covers_lines: [53, 54]
    priority: high
    status: integration_tested

  - id: SCHED-GRP-06
    name: "Error propagation"
    description: Error from descriptor fetch or transfer engines
    test_function: "test_stream_core (error_injection)"
    covers_lines: [63, 64]
    priority: high
    status: integration_tested

  - id: SCHED-GRP-07
    name: "Completion reporting"
    description: Generate completion event with descriptor ID
    test_function: "test_stream_core (func/full)"
    covers_lines: [63, 64]
    priority: medium
    status: integration_tested

# Parameter combinations tested (via integration)
parameter_coverage:
  - DATA_WIDTH: 512
    ADDR_WIDTH: 64
    ID_WIDTH: 8
    test_level: gate
    status: integration_tested

  - DATA_WIDTH: 256
    ADDR_WIDTH: 64
    ID_WIDTH: 8
    test_level: func
    status: integration_tested

# Implied coverage calculation
implied_coverage:
  total_points: 23
  verilator_tracked: 7
  scenario_tracked: 23
  implied_covered: 23
  implied_percentage: 100.0
  note: "Coverage achieved via integration testing"

notes: |
  scheduler_group is a MACRO-level module combining descriptor_engine
  and scheduler for single channel operation.

  GAP RATIONALE:
  - This module has NO direct macro-level test
  - Thoroughly tested via stream_core integration
  - Direct testing would duplicate stream_core test effort

  Integration Test Coverage:
  - Single channel flow: stream_core (gate)
  - Descriptor chains: stream_core (func)
  - Backpressure: stream_core (medium/full)
  - Error handling: stream_core (error_injection)

  Creating direct macro test would require:
  - Full descriptor memory model (already in stream_core)
  - AXI read/write engine stubs (already in stream_core)
  - Completion monitoring (already in stream_core)

  Better approach: Comprehensive integration testing at stream_core level.
  All functional scenarios covered via integration tests.

  Implied coverage is 100% via integration testing in stream_core.
