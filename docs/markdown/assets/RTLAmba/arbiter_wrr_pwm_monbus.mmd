%%{init: {'theme': 'neutral', 'themeVariables': { 'fontSize': '14px'}}}%%
flowchart TB
    subgraph Inputs["Monitor Bus Inputs"]
        REQ["req[N-1:0]"]
        DATA["data[N-1:0][63:0]"]
        WEIGHT["weight[N-1:0][W-1:0]"]
    end

    subgraph arbiter_wrr_pwm_monbus["arbiter_wrr_pwm_monbus"]
        subgraph Arbiter["Weighted Round-Robin"]
            WRR["arbiter_round_robin_weighted\nPriority by weight"]
        end

        subgraph Credits["Credit Management"]
            CRED["Per-requestor credits\nRefill on exhaustion"]
        end

        subgraph PWM["PWM Modulation"]
            PWM_CTRL["Bandwidth limiting\nper requestor"]
        end

        subgraph Mux["Output Mux"]
            MUX["Select winning\npacket data"]
        end
    end

    subgraph Outputs["Arbitrated Output"]
        GNT["grant[N-1:0]"]
        OUT_V["out_valid"]
        OUT_D["out_data[63:0]"]
    end

    REQ --> Arbiter
    WEIGHT --> Credits
    Credits --> Arbiter
    Arbiter --> PWM
    PWM --> GNT
    GNT --> Mux
    DATA --> Mux
    Mux --> OUT_V
    Mux --> OUT_D
