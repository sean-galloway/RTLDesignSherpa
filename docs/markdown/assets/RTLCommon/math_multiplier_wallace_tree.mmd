%%{init: {'theme': 'neutral', 'themeVariables': { 'fontSize': '14px'}}}%%
flowchart TB
    subgraph Inputs
        A["i_multiplier[N-1:0]"]
        B["i_multiplicand[N-1:0]"]
    end

    subgraph math_multiplier_wallace_tree["math_multiplier_wallace_tree_NNN"]
        subgraph PPGen["Partial Product Generation"]
            PP["PP[i][j] = A[i] AND B[j]\nN x N partial products"]
        end

        subgraph WallaceTree["Wallace Tree Reduction"]
            direction TB
            S1["Stage 1: Reduce height\nusing 3:2 compressors"]
            S2["Stage 2: Continue\nreduction"]
            S3["Stage 3: ..."]
            SN["Final: 2 rows"]
            CSA["3:2 Compressor (CSA)\nmath_adder_full"]
        end

        subgraph FinalAdd["Final Addition"]
            CPA["Carry Propagate Adder\n(Ripple/CLA/Prefix)"]
        end
    end

    subgraph Outputs
        PROD["ow_product[2N-1:0]"]
    end

    A --> PPGen
    B --> PPGen
    PPGen --> WallaceTree
    S1 --> S2
    S2 --> S3
    S3 --> SN
    WallaceTree --> FinalAdd
    FinalAdd --> PROD
