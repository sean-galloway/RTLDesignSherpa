# Testplan for dataint
# Auto-generated on 2026-01-18 01:27:07
# EDIT: Add functional scenarios to improve implied coverage

module: dataint
rtl_file: rtl/common/dataint.sv
test_file: val/common/test_dataint.py

# Raw Verilator coverage: 21/24 (87.5%)

# Coverage gaps by type:
#   input_port: 2 uncovered lines
#   signal_decl: 1 uncovered lines

# Coverage points
coverage_points:
  - line: 249
    type: input_port
    covered: False
    hit_count: 0
    content: "input  logic [CRC_WIDTH-1:0]  POLY,"

  - line: 250
    type: input_port
    covered: True
    hit_count: 20
    content: "input  logic [CRC_WIDTH-1:0]  POLY_INIT,"

  - line: 251
    type: input_port
    covered: True
    hit_count: 15
    content: "input  logic [CRC_WIDTH-1:0]  XOROUT,"

  - line: 252
    type: input_port
    covered: True
    hit_count: 268238
    content: "input  logic                  clk,"

  - line: 253
    type: input_port
    covered: True
    hit_count: 262
    content: "input  logic                  rst_n,"

  - line: 254
    type: input_port
    covered: True
    hit_count: 85832
    content: "input  logic                  load_crc_start,"

  - line: 255
    type: input_port
    covered: True
    hit_count: 85832
    content: "input  logic                  load_from_cascade,"

  - line: 256
    type: input_port
    covered: False
    hit_count: 0
    content: "input  logic [    CHUNKS-1:0] cascade_sel,        // one hot encoded"

  - line: 257
    type: input_port
    covered: True
    hit_count: 10400
    content: "input  logic [DATA_WIDTH-1:0] data,"

  - line: 258
    type: output_port
    covered: True
    hit_count: 7370
    content: "output logic [ CRC_WIDTH-1:0] crc"

  - line: 269
    type: signal_decl
    covered: True
    hit_count: 4425
    content: "logic [CW-1:0] r_crc_value;"

  - line: 270
    type: signal_decl
    covered: False
    hit_count: 0
    content: "logic [CW-1:0] w_poly;"

  - line: 271
    type: signal_decl
    covered: True
    hit_count: 10976
    content: "logic [7:0]    w_block_data[CH];  // verilog_lint: waive unpacked-dimensions-ran"

  - line: 272
    type: signal_decl
    covered: True
    hit_count: 296
    content: "logic [CW-1:0] w_cascade[CH];  // verilog_lint: waive unpacked-dimensions-range-"

  - line: 273
    type: signal_decl
    covered: True
    hit_count: 4867
    content: "logic [CW-1:0] w_result, w_result_xor, w_selected_cascade_output;"

  - line: 297
    type: always_comb
    covered: True
    hit_count: 934772
    content: "always_comb begin"

  - line: 298
    type: other
    covered: True
    hit_count: 934772
    content: "w_selected_cascade_output = POLY_INIT;  // Default to initial value"

  - line: 299
    type: other
    covered: True
    hit_count: 934772
    content: "for (int i = 0; i < CH; i++) begin"

  - line: 300
    type: if_statement
    covered: True
    hit_count: 300412
    content: "if (cascade_sel[i]) begin"

  - line: 301
    type: other
    covered: True
    hit_count: 300412
    content: "w_selected_cascade_output = w_cascade[i];"

  - line: 311
    type: other
    covered: True
    hit_count: 2882
    content: ")"

  - line: 358
    type: other
    covered: True
    hit_count: 2882
    content: ")"

  - line: 365
    type: signal_decl
    covered: True
    hit_count: 10976
    content: "logic [(CH*8)-1:0] flat_w_block_data;"

  - line: 372
    type: signal_decl
    covered: True
    hit_count: 5845
    content: "logic [(CW*CH)-1:0] flat_w_cascade;"


# Functional scenarios
# Map test scenarios to coverage points based on test_dataint_crc.py
functional_scenarios:
  - id: DINT-01
    name: "CRC initialization"
    description: "Load CRC with POLY_INIT value at start of calculation"
    test_function: "crc_basic_test (initialization phase)"
    covers_lines: [250, 252, 253, 254, 269, 297, 298]
    priority: high
    status: verified

  - id: DINT-02
    name: "CRC data processing"
    description: "Process input data through CRC calculation engine with cascaded XOR-shift blocks"
    test_function: "crc_basic_test (main_loop)"
    covers_lines: [252, 253, 257, 269, 271, 272, 273, 297, 298, 299, 300, 301, 311, 358]
    priority: high
    status: verified

  - id: DINT-03
    name: "CRC cascade selection"
    description: "Select output from cascaded CRC blocks using one-hot cascade_sel"
    test_function: "crc_basic_test (cascade mux)"
    covers_lines: [255, 269, 272, 273, 297, 298, 299, 300, 301]
    priority: high
    status: verified

  - id: DINT-04
    name: "CRC load from cascade"
    description: "Load CRC register from selected cascade output for multi-byte processing"
    test_function: "crc_basic_test (cascade feedback)"
    covers_lines: [255, 269, 272, 297, 298, 299, 300, 301]
    priority: high
    status: verified

  - id: DINT-05
    name: "CRC XOROUT application"
    description: "Apply XOROUT value to final CRC result for standard algorithm compliance"
    test_function: "crc_basic_test (finalization)"
    covers_lines: [251, 273, 358]
    priority: high
    status: verified

  - id: DINT-06
    name: "Multi-chunk data processing"
    description: "Process data in chunks (8-bit blocks) through cascaded CRC engines"
    test_function: "crc_basic_test (chunked processing)"
    covers_lines: [257, 271, 272, 297, 299, 300, 301, 311, 358, 365, 372]
    priority: high
    status: verified

  - id: DINT-07
    name: "Clock and reset handling"
    description: "Verify synchronous reset and clock edge behavior"
    test_function: "crc_basic_test (reset and clock phases)"
    covers_lines: [252, 253, 269]
    priority: high
    status: verified

  - id: DINT-08
    name: "CRC start/restart"
    description: "Load CRC start value (POLY_INIT) when load_crc_start asserted"
    test_function: "crc_basic_test (start control)"
    covers_lines: [250, 254, 269]
    priority: high
    status: verified

  - id: DINT-09
    name: "Standard CRC algorithms"
    description: "Test multiple standard CRC algorithms (CRC-8, CRC-16, CRC-32, etc.) across 250+ configurations"
    test_function: "crc_basic_test (parameterized with crc_parameters)"
    covers_lines: [250, 251, 252, 253, 254, 255, 257, 269, 271, 272, 273, 297, 298, 299, 300, 301, 311, 358, 365, 372]
    priority: high
    status: verified

  - id: DINT-10
    name: "Dynamic polynomial selection"
    description: "Runtime polynomial selection via POLY input parameter"
    test_function: "Not tested - POLY is compile-time parameter"
    covers_lines: [249, 270]
    priority: low
    status: not_applicable
    notes: "POLY input is for parameterization flexibility but tests use compile-time parameters. Line 249 (POLY input) and line 270 (w_poly signal) are not exercised in current test flow."

  - id: DINT-11
    name: "One-hot cascade selector"
    description: "Verify one-hot encoding of cascade_sel for block selection"
    test_function: "crc_basic_test (cascade selection logic)"
    covers_lines: [255, 257, 272, 297, 299, 300, 301]
    priority: high
    status: verified
    notes: "Line 256 (cascade_sel input port) may not be counted by Verilator as executable but is functionally exercised."

# Implied coverage calculation
implied_coverage:
  total_points: 24
  verilator_covered: 21
  scenario_covered: 21  # All Verilator-tracked lines covered by functional scenarios
  implied_percentage: 87.5  # 21/24 * 100 (matches Verilator coverage)
  notes: |
    Uncovered lines:
    - Line 249 (POLY input): Runtime polynomial selection not used in tests (compile-time params instead)
    - Line 256 (cascade_sel input): Port declaration, functionally exercised but may not be tracked
    - Line 270 (w_poly signal): Internal signal for dynamic POLY, not used with compile-time params

    All functional CRC operations are comprehensively tested across 250+ algorithm configurations.
    The test suite validates CRC-8, CRC-16, CRC-32, and other standards with different:
    - Polynomials, initial values, reflection modes, XOR-out values
    - Data widths (8, 16, 32, 64 bits)
    - Processing modes (cascaded multi-byte blocks)